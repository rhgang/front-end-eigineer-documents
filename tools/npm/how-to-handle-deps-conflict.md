## npm如何处理依赖冲突

### 依赖冲突

早期的npm(V2)依赖管理是读取每个模块的依赖列表，并下载对应的依赖到该模块的node_modules目录下；如果依赖的模块又依赖了其他模块，则会继续下载模块到依赖的模块的目录下，依次递归，最终有一棵庞大的依赖树。

虽然保证了每个项目的依赖独立，但是当项目规模变大，会造成一些问题：  

* 依赖树的层级非常深。
* 不同的依赖树分支里，可能有大量实际上是同样版本的依赖。
* 安装时额外下载或拷贝了大量重复的资源。
* 安装速度慢

### 依赖共享

npm v3 版本之后，npm采用了更合理的方式去解决这个问题。

npm v3 尝试把依赖以及依赖的依赖都尽量的平铺在项目根目录下的 node_modules 文件夹下以共享使用；如果遇到因为需要的版本要求不一致导致冲突，没办法放在平铺目录下的，回退到 npm v2 的处理方式，在该模块下的 node_modules 里存放冲突的模块。

### 参考
* [npm 如何处理依赖与依赖冲突](http://aprilandjan.github.io/npm/2019/08/02/how-npm-handles-dependency-version-conflict/)

